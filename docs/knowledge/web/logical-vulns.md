# 逻辑漏洞挖掘

**挖掘重点：**

**业务流程和HTTP/HTTPS请求篡改。**

# 常见的逻辑漏洞

其中 2、3、4 是金融业务中常见的。

**(1) 密码重置**

> 验证码直接在HTTP响应中返回；
>
> 验证码未绑定用户，没和手机号和邮箱号做匹配验证；
>
> 未校验用户字段值，改自己密码，最后提交其它UID；
>
> 验证码不失效，可枚举；
>

**(2) 支付订单**

> 篡改支付金额，运费修改为负数，使总金额降低。

**(3) 竞争条件**

> 在文件上传中和购物时；
>
> A用户余额10元，B商品5元，C商品6元;
>
> A利用竞争条件多线程同时发起购买B和C的请求；
>
> 可能的结果有：
>
> 有一件商品购买失败；
>
> 商品都购买成功，但只扣了6元；
>
> 商品都购买成功，但余额为 -1元；

**(4) 越权访问**

> 越权访问他人信息或操纵他人账号
>
> 
>
> **水平越权：**
>
> 同级别(权限)用户之间，越权访问非法操纵其它账户；(这会导致大批量数据泄露，恶意篡改)
>
> **垂直越权：**
>
> 不同级别之间的用户越权，普通用户执行管理员的功能；

**越权访问攻击测试：**

```bash
1、改ID; ?id=1
2、改用户名；login.php?username=admin
```

**越权访问修复建议：**

越权访问漏洞的主要原因是没有对用户的身份做判断和控制，防护这种漏洞可以通过session来控制。

用户登录成功后，把username和UID等信息写入到session中，

当查看个人信息时，从session中取出username，而不是从GET和POST取，此时username就是没被篡改的。